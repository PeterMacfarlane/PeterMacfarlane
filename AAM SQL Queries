




Proposals
SELECT Proposal.Proposal_Name,.
Proposal.ID,
--Proposal.CAMPAIGN,
Proposal.FUND,
Proposal.STATUS,
FUND.DESCRIPTION Fund,
CAMPAIGN.DESCRIPTION Campaign,
SName.LONGDESCRIPTION Status,
AMOUNT_ASKED,
AMOUNT_EXPECTED,
AMOUNT_FUNDED,
CASE PROPOSAL.INACTIVE
WHEN -1 THEN 'Inactive'
WHEN 0 THEN 'Active'
END Active,
FCat.LONGDESCRIPTION,
CASE
WHEN R.ORG_NAME IS NOT NULL THEN R.ORG_NAME
ELSE CONCAT(R.FIRST_NAME,' ',R.LAST_NAME)
END NAME,
CASE
WHEN R.ORG_NAME IS NOT NULL THEN R.ORG_NAME
ELSE R.LAST_NAME
END SortName,
CAST(LEFT(SName.LONGDESCRIPTION,(CHARINDEX('.',SName.LONGDESCRIPTION)-1))AS int) Statussort

FROM PROPOSAL
LEFT JOIN FUND ON Fund.ID=PROPOSAL.FUND
LEFT JOIN CAMPAIGN ON CAMPAIGN.ID=PROPOSAL.CAMPAIGN
LEFT JOIN TABLEENTRIES SName ON SName.TABLEENTRIESID=PROPOSAL.STATUS
LEFT JOIN TABLEENTRIES FCat ON FCat.TABLEENTRIESID=FUND.FUND_CATEGORY
LEFT JOIN PROSPECT ON PROSPECT.ID=PROPOSAL.PROSPECT_ID
LEFT JOIN RECORDS R ON R.ID=PROSPECT.CONSTIT_ID
WHERE FUND.INACTIVE=0
AND Fcat.LONGDESCRIPTION LIKE 'Exhib%'
AND Proposal.status NOT IN (8736)
AND PROPOSAL.INACTIVE=0
AND FUND.DESCRIPTION IN (@Exhibitions)

ORDER BY Fund.DESCRIPTION, Campaign

ACTIVE FUNDS

SELECT FUND.DESCRIPTION Fund
FROM FUND
LEFT JOIN TABLEENTRIES FCat ON FCat.TABLEENTRIESID=FUND.FUND_CATEGORY
WHERE FUND.INACTIVE=0
AND Fcat.LONGDESCRIPTION LIKE 'Exhib%'
AND Fund.ID IN
(SELECT Fund FROM Proposal WHERE Proposal.inactive=0)
AND FUND.ID NOT IN (316,162)
ORDER BY FUND.DESCRIPTION
;

SUM

SELECT FUND.DESCRIPTION Fund,
SName.LONGDESCRIPTION Status,
SUM(AMOUNT_ASKED) Asked,
SUM(AMOUNT_EXPECTED) Expected,
SUM(AMOUNT_FUNDED) Funded,
CAST(LEFT(SName.LONGDESCRIPTION,(CHARINDEX('.',SName.LONGDESCRIPTION)-1))AS int) Statussort,
COUNT(Proposal.ID) count

FROM PROPOSAL
LEFT JOIN FUND ON Fund.ID=PROPOSAL.FUND
LEFT JOIN CAMPAIGN ON CAMPAIGN.ID=PROPOSAL.CAMPAIGN
LEFT JOIN TABLEENTRIES SName ON SName.TABLEENTRIESID=PROPOSAL.STATUS
LEFT JOIN TABLEENTRIES FCat ON FCat.TABLEENTRIESID=FUND.FUND_CATEGORY
WHERE FUND.INACTIVE=0
AND (Fcat.LONGDESCRIPTION LIKE 'Exhib%'
AND FUND.ID NOT IN (316,162))
AND PROPOSAL.INACTIVE=0
AND Proposal.status NOT IN (8736)
AND FUND.DESCRIPTION IN (@Exhibitions)
GROUP BY FUND.DESCRIPTION, SName.LONGDESCRIPTION, CAST(LEFT(SName.LONGDESCRIPTION,(CHARINDEX('.',SName.LONGDESCRIPTION)-1))AS int)

UNION

SELECT agg.Fund,
'8. Funded' Status,
'0' Asked,
'0' Expected,
agg.Funded,
8 Statussort,
agg.gftcnt
FROM
(
    SELECT
    FUND.DESCRIPTION Fund,
    SUM(GiftSplit.Amount) Funded,
    Count(gift.id) gftcnt
    FROM Gift
    LEFT JOIN GiftSplit ON gift.ID=GiftSplit.GiftId
    LEFT JOIN FUND ON Fund.ID=GiftSplit.FundId
    LEFT JOIN CAMPAIGN ON CAMPAIGN.ID=GiftSplit.CampaignId
    LEFT JOIN TABLEENTRIES FCat ON FCat.TABLEENTRIESID=FUND.FUND_CATEGORY
    WHERE FUND.INACTIVE=0
    AND (Fcat.LONGDESCRIPTION LIKE 'Exhib%'
    AND GiftSplit.FundId NOT IN (316,162))
    AND Gift.TYPE IN(1, 8, 9, 10, 18, 27, 31)
    AND FUND.DESCRIPTION IN (@Exhibitions)
    GROUP BY FUND.DESCRIPTION
) agg

ORDER BY Fund.DESCRIPTION, Statussort

Gifts

SELECT GiftSplit.Amount,
FUND.DESCRIPTION Fund,
GIFT.DTE,
CAMPAIGN.DESCRIPTION Campaign,
FCat.LONGDESCRIPTION,
CASE
WHEN R.ORG_NAME IS NOT NULL THEN R.ORG_NAME
ELSE CONCAT(R.FIRST_NAME,' ',R.LAST_NAME)
END NAME,
CASE
WHEN R.ORG_NAME IS NOT NULL THEN R.ORG_NAME
ELSE R.LAST_NAME
END SortName

FROM Gift
LEFT JOIN GiftSplit ON gift.ID=GiftSplit.GiftId
LEFT JOIN FUND ON Fund.ID=GiftSplit.FundId
LEFT JOIN CAMPAIGN ON CAMPAIGN.ID=GiftSplit.CampaignId
LEFT JOIN TABLEENTRIES FCat ON FCat.TABLEENTRIESID=FUND.FUND_CATEGORY
LEFT JOIN RECORDS R ON R.ID=gift.CONSTIT_ID
WHERE FUND.INACTIVE=0
AND (Fcat.LONGDESCRIPTION LIKE 'Exhib%'
AND GiftSplit.FundId NOT IN (316,162))
AND Gift.TYPE IN(1, 8, 9, 10, 18, 27, 31)
AND FUND.DESCRIPTION IN (@Exhibitions)
ORDER BY Fund.DESCRIPTION, Campaign
